<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Mobilidade Urbana</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <link rel="shortcut icon" href="./img/icone_site.png" type="image/x-icon" />
    <link rel="stylesheet" href="./styles.css" />
    <style>
      .login-container {
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .dark .login-container {
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      }
      
      .login-card {
        background: white;
        border-radius: 24px;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        overflow: hidden;
        transition: all 0.3s ease;
      }
      
      .dark .login-card {
        background: #1e293b;
      }
      
      .login-side {
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.9), rgba(245, 158, 11, 0.9)),
                    url('./img/icone_site.png');
        background-size: cover;
        background-position: center;
      }
      
      .dark .login-side {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.95)),
                    url('./img/icone_site.png');
        background-size: cover;
        background-position: center;
      }
      
      .input-group {
        position: relative;
        margin-bottom: 1.5rem;
      }
      
      .input-group input {
        width: 100%;
        padding: 14px 16px 14px 48px;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        font-size: 16px;
        transition: all 0.3s ease;
        background: #f9fafb;
      }
      
      .dark .input-group input {
        background: #0f172a;
        border-color: #334155;
        color: #f1f5f9;
      }
      
      .input-group input:focus {
        outline: none;
        border-color: #fbbf24;
        background: white;
        box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.1);
        transform: translateY(-2px);
      }
      
      .dark .input-group input:focus {
        background: #1e293b;
        box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.2);
      }
      
      .input-icon {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: #9ca3af;
        pointer-events: none;
      }
      
      .btn-login {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      
      .btn-login:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(251, 191, 36, 0.4);
      }
      
      .btn-login:active {
        transform: translateY(0);
      }
      
      .btn-login:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }
      
      .floating-shapes {
        position: absolute;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: 0;
      }
      
      .shape {
        position: absolute;
        opacity: 0.1;
      }
      
      .shape-1 {
        width: 300px;
        height: 300px;
        background: #fbbf24;
        border-radius: 50%;
        top: -150px;
        right: -150px;
        animation: float 8s ease-in-out infinite;
      }
      
      .shape-2 {
        width: 200px;
        height: 200px;
        background: #f59e0b;
        border-radius: 50%;
        bottom: -100px;
        left: -100px;
        animation: float 6s ease-in-out infinite reverse;
      }
    </style>
  </head>
  <body>
    <div class="login-container">
      <div class="floating-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
      </div>
      
      <div class="login-card max-w-5xl w-full mx-4 animate-scale-in" style="max-width: 1000px;">
        <div class="md:flex">
          <!-- Left Side - Decorative -->
          <div class="login-side md:w-2/5 p-12 flex flex-col justify-center items-center text-white relative overflow-hidden">
            <div class="relative z-10 text-center">
              <div class="mb-6 animate-float">
                <div class="bg-white/20 backdrop-blur-lg p-6 rounded-3xl inline-block">
                  <i data-feather="bus" class="w-20 h-20"></i>
                </div>
              </div>
              <h2 class="text-3xl font-bold mb-4">Bem-vindo de volta!</h2>
              <p class="text-lg opacity-90">
                Acesse sua conta e continue aproveitando nossos serviços de mobilidade urbana.
              </p>
            </div>
          </div>
          
          <!-- Right Side - Form -->
          <div class="md:w-3/5 p-12 relative z-10">
            <div class="max-w-md mx-auto">
              <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
                  Faça seu login
                </h2>
                <p class="text-gray-600 dark:text-gray-400">
                  Entre com suas credenciais para acessar o sistema
                </p>
              </div>

              <form id="loginForm">
                <div
                  id="errorMessage"
                  class="hidden mb-6 bg-red-50 dark:bg-red-900/20 border-2 border-red-200 dark:border-red-800 text-red-700 dark:text-red-300 px-4 py-3 rounded-xl animate-fade-in"
                ></div>

                <div class="input-group">
                  <i data-feather="user" class="input-icon w-5 h-5"></i>
                  <input
                    type="text"
                    id="username"
                    name="username"
                    required
                    placeholder="Seu nome de usuário"
                  />
                </div>

                <div class="input-group">
                  <i data-feather="lock" class="input-icon w-5 h-5"></i>
                  <input
                    type="password"
                    id="password"
                    name="password"
                    required
                    placeholder="Sua senha"
                  />
                </div>

                <div class="flex items-center justify-between mb-6">
                  <label class="flex items-center cursor-pointer">
                    <input
                      id="remember-me"
                      name="remember-me"
                      type="checkbox"
                      class="w-4 h-4 text-yellow-600 border-gray-300 rounded focus:ring-yellow-500"
                    />
                    <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                      Lembrar de mim
                    </span>
                  </label>

                  <a
                    href="forgot-password.html"
                    class="text-sm font-medium text-yellow-600 dark:text-yellow-400 hover:text-yellow-700 dark:hover:text-yellow-300 transition"
                  >
                    Esqueceu a senha?
                  </a>
                </div>

                <button
                  type="submit"
                  id="loginButton"
                  class="btn-login mb-6"
                >
                  <span id="loginButtonText">Entrar</span>
                </button>
              </form>

              <div class="relative mb-6">
                <div class="absolute inset-0 flex items-center">
                  <div class="w-full border-t border-gray-300 dark:border-gray-700"></div>
                </div>
                <div class="relative flex justify-center text-sm">
                  <span class="px-4 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400">
                    Ou
                  </span>
                </div>
              </div>

              <p class="text-center text-gray-600 dark:text-gray-400">
                Não tem uma conta?
                <a
                  href="register.html"
                  class="font-semibold text-yellow-600 dark:text-yellow-400 hover:text-yellow-700 dark:hover:text-yellow-300 transition"
                >
                  Cadastre-se gratuitamente
                </a>
              </p>

              <div class="mt-8 text-center">
                <a
                  href="index.html"
                  class="inline-flex items-center space-x-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition"
                >
                  <i data-feather="arrow-left" class="w-4 h-4"></i>
                  <span>Voltar para home</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      feather.replace();

      document
        .getElementById("loginForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const username = document.getElementById("username").value;
          const password = document.getElementById("password").value;
          const errorDiv = document.getElementById("errorMessage");
          const loginButton = document.getElementById("loginButton");
          const loginButtonText = document.getElementById("loginButtonText");

          // Limpar mensagens de erro
          errorDiv.classList.add("hidden");

          // Desabilitar botão durante o login
          loginButton.disabled = true;
          loginButtonText.textContent = "Entrando...";
          loginButton.classList.add("animate-pulse");

          try {
            const response = await fetch("/api/login", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              credentials: "include",
              body: JSON.stringify({
                username: username,
                password: password,
              }),
            });

            const data = await response.json();

            if (response.ok) {
              // Login bem-sucedido
              loginButtonText.textContent = "Sucesso! Redirecionando...";
              loginButton.classList.remove("animate-pulse");
              
              // Animação de sucesso
              loginButton.style.background = "linear-gradient(135deg, #10b981, #059669)";
              
              setTimeout(() => {
                window.location.href = "dashboard.html";
              }, 500);
            } else {
              // Mostrar erro
              errorDiv.textContent = data.error || "Erro ao fazer login";
              errorDiv.classList.remove("hidden");
              
              // Shake animation
              errorDiv.style.animation = "shake 0.5s";
              setTimeout(() => {
                errorDiv.style.animation = "";
              }, 500);
            }
          } catch (error) {
            console.error("Erro:", error);
            errorDiv.textContent = "Erro de conexão. Tente novamente.";
            errorDiv.classList.remove("hidden");
          } finally {
            // Reabilitar botão
            loginButton.disabled = false;
            loginButtonText.textContent = "Entrar";
            loginButton.classList.remove("animate-pulse");
            loginButton.style.background = "";
          }
        });

      // Theme handling
      function applyTheme(isDark) {
        const html = document.documentElement;
        if (isDark) {
          html.classList.add('dark');
          html.classList.remove('light');
        } else {
          html.classList.remove('dark');
          html.classList.add('light');
        }
        feather.replace();
      }

      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      let isDark = savedTheme === 'dark' || (savedTheme === null && prefersDark);
      applyTheme(isDark);
      
      // Shake animation
      const style = document.createElement('style');
      style.textContent = `
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-10px); }
          75% { transform: translateX(10px); }
        }
      `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
